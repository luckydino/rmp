import{j as e,B as W,aw as O,ax as re,aK as B,O as C,aM as ie,U as le,D as oe,_ as Z,$ as J,a0 as Q,a1 as Y,a3 as ee,a5 as te,a4 as F}from"./chakra-xNcrfRXW.js";import{c as P,d as w,aA as ce,T as de,aw as ue,aB as pe,t as N,v as S,l as I,ar as R,k as he,o as ge,P as H,aC as U,q as E,i as V,m as ne,aD as me,y as D,ax as $,aE as fe,aF as xe,aG as ye,aH as be,as as je,n as q}from"./index-BW1QegAX.js";import{u as k,b as p}from"./react-D-_si4LB.js";import{u as K,e as Se}from"./clipboard-B00pYyYr.js";import{s as G}from"./master-manager-Bef-bg2c.js";import{C as we,c as Ae,a as Ce,b as Ne}from"./change-type-modal-CmTxMSlw.js";import{LearnHowToAdd as Te}from"./tools-Jf3gkMij.js";import{m as Ee}from"./misc-nodes-Crh_bVS0.js";function ve(){const{t:n}=k(),i=P(),{selected:d}=w(a=>a.runtime),l=p.useRef(window.graph),c=a=>{if(l.current.hasNode(a)){const r=l.current.getNodeAttributes(a),o=r.type;return a.startsWith("stn")?r[o].names.join("/"):o}else if(l.current.hasEdge(a)){const[r,o]=l.current.extremities(a),g=l.current.getSourceAttributes(a),x=l.current.getTargetAttributes(a),h=g.type,u=x.type;return(r.startsWith("stn")?g[h].names[0]:h)+" - "+(o.startsWith("stn")?x[u].names[0]:u)}},[t,s]=p.useState([]);p.useEffect(()=>{s(["station","misc-node","line"])},[d]);const[m,f]=p.useState(!1);return e.jsxs(W,{children:[e.jsxs(O,{as:"h5",size:"sm",children:[n("panel.details.multipleSelection.selected")," ",d.size]}),e.jsxs(re,{m:"var(--chakra-space-1)",children:[e.jsxs(B,{w:"100%",children:[e.jsx(O,{as:"h5",size:"xs",w:"100%",children:n("panel.details.multipleSelection.show")}),e.jsx(ce,{selections:[{label:n("panel.details.multipleSelection.station"),value:"station"},{label:n("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:n("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:t,multiSelect:!0,onChange:a=>s(a)})]}),t.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{width:"100%",size:"sm",onClick:()=>f(!0),children:[n("panel.details.multipleSelection.change"),e.jsx(ie,{label:n("header.settings.pro"),children:e.jsx(le,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(oe,{})]}),[...d].filter(a=>t.includes("station")||!a.startsWith("stn")).filter(a=>t.includes("misc-node")||!a.startsWith("misc")).filter(a=>t.includes("line")||!a.startsWith("line")).map(a=>{var r;return e.jsxs(B,{width:"100%",children:[e.jsx(C,{width:"100%",size:"sm",variant:"solid",onClick:()=>i(de(new Set([a]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(r=c(a))==null?void 0:r.replaceAll("\n","⏎")}),e.jsx(C,{size:"sm",onClick:()=>i(ue(a)),children:e.jsx(pe,{})})]},a)})]}),e.jsx(we,{isOpen:m,onClose:()=>f(!1),isSelect:!0,filter:t})]})}function Pe(){const{t:n}=k(),i=P(),d=p.useCallback(()=>{i(N()),i(S(m.current.export()))},[i,N,S]),{preference:{autoParallel:l}}=w(b=>b.app),{selected:c,theme:t}=w(b=>b.runtime),[s]=c,m=p.useRef(window.graph),[f,a]=p.useState(!1),r=p.useRef(null),o=Object.fromEntries(Object.entries(I).map(([b,_])=>[b,n(_.metadata.displayName).toString()])),[g,x]=p.useState(m.current.getEdgeAttribute(s,"type")),[h,u]=p.useState(void 0),y=Object.fromEntries(Object.entries(R).map(([b,_])=>[b,n(_.metadata.displayName).toString()])),[v,j]=p.useState(m.current.getEdgeAttribute(s,"style")),[A,T]=p.useState(void 0);p.useEffect(()=>{x(m.current.getEdgeAttribute(s,"type")),j(m.current.getEdgeAttribute(s,"style"))},[s]);const z=Object.values(he).filter(b=>!R[v].metadata.supportLinePathType.includes(b)),L=Object.values(ge).filter(b=>!R[b].metadata.supportLinePathType.includes(g)),se=()=>{h&&(Ae(m.current,s,h,l),x(m.current.getEdgeAttribute(s,"type")),d())},ae=()=>{A&&(Ce(m.current,s,A,t),j(m.current.getEdgeAttribute(s,"style")),d())},M=b=>{b&&(h?(se(),u(void 0)):A&&(ae(),T(void 0))),a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{label:n("panel.details.info.linePathType"),minW:"276",children:e.jsx(U,{options:o,disabledOptions:z,defaultValue:g,value:g,onChange:({target:{value:b}})=>{u(b),a(!0)}})}),e.jsx(H,{label:n("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(U,{options:y,disabledOptions:L,defaultValue:v,value:v,onChange:({target:{value:b}})=>{T(b),a(!0)}})}),e.jsx(Te,{type:"line",expand:!0}),e.jsx(Z,{isOpen:f,leastDestructiveRef:r,onClose:()=>M(!1),children:e.jsx(J,{children:e.jsxs(Q,{children:[e.jsx(Y,{children:n("warning")}),e.jsx(ee,{children:n("panel.details.changeLineTypeContent")}),e.jsxs(te,{children:[e.jsx(C,{ref:r,onClick:()=>M(!1),children:n("cancel")}),e.jsx(C,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:n("panel.details.changeType")})]})]})})})]})}function ke(){const{t:n}=k(),i=P(),d=p.useCallback(()=>{i(E()),i(S(t.current.export()))},[i,E,S]),{selected:l}=w(u=>u.runtime),[c]=l,t=p.useRef(window.graph),[s,m]=p.useState(!1),f=p.useRef(null),[a,r]=p.useState(void 0),o=t.current.getNodeAttribute(c,"type"),g=Object.fromEntries(Object.entries(G).map(([u,y])=>[u,n(y.metadata.displayName).toString()])),x=()=>{a&&(Ne(t.current,c,a),d())},h=u=>{u&&x(),r(void 0),m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(U,{options:g,disabledOptions:[o],value:o,onChange:({target:{value:u}})=>{r(u),m(!0)}})}),e.jsx(Z,{isOpen:s,leastDestructiveRef:f,onClose:()=>h(!1),children:e.jsx(J,{children:e.jsxs(Q,{children:[e.jsx(Y,{children:n("warning")}),e.jsx(ee,{children:n("panel.details.changeStationTypeContent")}),e.jsxs(te,{children:[e.jsx(C,{ref:f,onClick:()=>h(!1),children:n("cancel")}),e.jsx(C,{ml:"2",colorScheme:"red",onClick:()=>h(!0),children:n("panel.details.changeType")})]})]})})})]})}function ze(){const{t:n}=k(),i=P(),d=p.useCallback(()=>{i(E()),i(N()),i(S(s.current.export()))},[i,E,N,S]);w(o=>o.account);const{selected:l,parallelLinesCount:c}=w(o=>o.runtime),[t]=l,s=p.useRef(window.graph),m=o=>{const g=Math.min(Math.max(o,-10),10);s.current.hasNode(t)&&s.current.setNodeAttribute(t,"zIndex",g),s.current.hasEdge(t)&&s.current.setEdgeAttribute(t,"zIndex",g),d()},f=(o,g)=>{let x=-1;if(o){const h=s.current.getEdgeAttributes(t),[u,y]=s.current.extremities(t);x=ne(s.current,h.type,u,y,g)}a(x)},a=o=>{s.current.setEdgeAttribute(t,"parallelIndex",o),i(N()),i(S(s.current.export()))},r=[];if(l.size!==0)if(l.size===1){if(r.push({type:"input",label:n("panel.details.info.id"),value:t,minW:276}),r.push({type:"select",label:n("panel.details.info.zIndex"),value:t?s.current.hasNode(t)?s.current.getNodeAttribute(t,"zIndex"):s.current.hasEdge(t)?s.current.getEdgeAttribute(t,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(o,g)=>[g-10,(g-10).toString()])),onChange:o=>m(Number(o))}),s.current.hasEdge(t)){const o=s.current.getEdgeAttributes(t),g=o.parallelIndex,x=me,h=c>x&&g<0,u=c>x&&g>=0;r.push({type:"switch",label:n("panel.details.info.parallel"),isDisabled:h,isChecked:g>=0,onChange:y=>f(y,o[o.type].startFrom),oneLine:!0,minW:276}),g>=0&&r.push({type:"input",label:n("panel.details.info.parallelIndex"),variant:"number",isDisabled:u,value:o.parallelIndex.toString(),onChange:y=>a(Number(y)),minW:276})}}else l.size>1&&r.push({type:"input",label:n("panel.details.info.type"),value:n("panel.details.multipleSelection.title"),minW:276});return e.jsxs(W,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(V,{fields:r,minW:130}),l.size===1&&t.startsWith("stn")&&s.current.hasNode(t)&&s.current.getNodeAttribute(t,"type")in G&&e.jsx(ke,{}),l.size===1&&t.startsWith("line")&&s.current.hasEdge(t)&&s.current.getEdgeAttribute(t,"type")in I&&s.current.getEdgeAttribute(t,"style")in R&&e.jsx(Pe,{}),l.size>1&&e.jsx(ve,{})]})}function Le(){const{t:n}=k(),i=P(),{selected:d}=w(y=>y.runtime),[l]=d,c=p.useRef(window.graph),[t,s]=p.useState("undefined"),[m,f]=p.useState("undefined"),[a,r]=p.useState("undefined"),[o,g]=p.useState("undefined");p.useEffect(()=>{var y,v,j,A;if(l!=null&&l.startsWith("line")){const[T,z]=c.current.extremities(l);if(s(T),f(z),T.startsWith("stn")){const L=c.current.getNodeAttribute(T,"type");r((v=(y=c.current.getNodeAttribute(T,L))==null?void 0:y.names.at(0))!=null?v:"undefined")}if(z.startsWith("stn")){const L=c.current.getNodeAttribute(z,"type");g((A=(j=c.current.getNodeAttribute(z,L))==null?void 0:j.names.at(0))!=null?A:"undefined")}}},[d]);const x=K(()=>{i(D()),i($(t))}),h=K(()=>{i(D()),i($(m))}),u=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(C,{ml:"auto",size:"sm",variant:"link",onClick:x,children:t}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:a,minW:"full"},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(C,{ml:"auto",size:"sm",variant:"link",onClick:h,children:m}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:o,minW:"full"}];return e.jsxs(W,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(V,{fields:u,minW:130})]})}function Re(){const{t:n}=k(),i=P(),d=p.useCallback(()=>{i(E()),i(N()),i(S(s.current.export()))},[i,E,N,S]),{selected:l,refresh:{nodes:c}}=w(r=>r.runtime),[t]=l,s=p.useRef(window.graph),[m,f]=p.useState({x:0,y:0});p.useEffect(()=>{if(t!=null&&t.startsWith("stn")||t!=null&&t.startsWith("misc_node_")){const r=s.current.getNodeAttribute(t,"x"),o=s.current.getNodeAttribute(t,"y");f({x:r,y:o})}},[c,l]);const a=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:m.x.toString(),validator:r=>!Number.isNaN(r),onChange:r=>{s.current.mergeNodeAttributes(t,{x:Number(r)}),d()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:m.y.toString(),validator:r=>!Number.isNaN(r),onChange:r=>{s.current.mergeNodeAttributes(t,{y:Number(r)}),d()}}];return e.jsxs(W,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(V,{fields:a,minW:130})]})}const X={...G,...Ee},Oe=()=>{var f;const n=P(),{selected:i}=w(a=>a.runtime),{t:d}=k(),[l]=i,c=window.graph.getNodeAttribute(l,"type"),t=c in X&&X[c].attrsComponent,s=(f=window.graph.getNodeAttribute(l,c))!=null?f:{},m=(a,r)=>{const o=window.graph.getNodeAttribute(a,"type");window.graph.mergeNodeAttributes(a,{[o]:r}),n(E()),n(S(window.graph.export()))};return t?e.jsx(t,{id:l,attrs:s,handleAttrsUpdate:m}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.node")})})},We=()=>{var y,v;const n=P(),{preference:{autoParallel:i}}=w(j=>j.app),{selected:d}=w(j=>j.runtime),{t:l}=k(),[c]=d,{type:t,style:s,parallelIndex:m,reconcileId:f}=window.graph.getEdgeAttributes(c),a=(y=window.graph.getEdgeAttribute(c,t))!=null?y:{},r=t in I&&I[t].attrsComponent,o=(v=window.graph.getEdgeAttribute(c,s))!=null?v:{},g=s in R&&R[s].attrsComponent,x=(j,A)=>{let T=-1;if(i){const[z,L]=window.graph.extremities(j);T=ne(window.graph,t,z,L,A)}window.graph.setEdgeAttribute(j,"parallelIndex",T)},h=(j,A)=>{window.graph.mergeEdgeAttributes(j,{[t]:A}),n(N()),n(S(window.graph.export()))},u=(j,A)=>{window.graph.mergeEdgeAttributes(j,{[s]:A}),n(N()),n(S(window.graph.export()))};return e.jsxs(e.Fragment,{children:[r?e.jsx(r,{id:c,attrs:a,recalculateParallelIndex:x,handleAttrsUpdate:h,parallelIndex:m}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:l("panel.details.unknown.error",{category:l("panel.details.unknown.linePath")})}),g?e.jsx(g,{id:c,attrs:o,handleAttrsUpdate:u,reconcileId:f}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:l("panel.details.unknown.error",{category:l("panel.details.unknown.lineStyle")})})]})},Ve=()=>{const{t:n}=k(),i=P(),d=p.useRef(window.graph),l=p.useCallback(()=>{i(E()),i(N()),i(S(d.current.export()))},[i,E,N,S]);w(h=>h.account);const{selected:c,mode:t,active:s,masterNodesCount:m}=w(h=>h.runtime),[f]=c,a=!1,r=()=>i(D()),o=h=>{const u=structuredClone(d.current.getNodeAttributes(h));u.x+=50,u.y+=50;const y=h.startsWith("stn")?"stn_".concat(q(10)):"misc_node_".concat(q(10));d.current.addNode(y,u),i(E()),i(S(d.current.export()))},g=h=>{const u=Se(d.current,h);navigator.clipboard.writeText(u)},x=h=>{i(D()),h.forEach(u=>{d.current.hasNode(u)?d.current.dropNode(u):d.current.hasEdge(u)&&d.current.dropEdge(u)}),l()};return e.jsxs(fe,{isOpen:c.size>0&&!t.startsWith("line")&&!s,width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(xe,{onClose:r,children:n("panel.details.header")}),e.jsxs(ye,{children:[e.jsx(ze,{}),c.size===1&&d.current.hasNode(f)&&e.jsx(Re,{}),c.size===1&&d.current.hasEdge(f)&&e.jsx(Le,{}),c.size===1&&e.jsxs(W,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(f)&&e.jsx(Oe,{}),window.graph.hasEdge(f)&&e.jsx(We,{})]})]}),e.jsx(be,{children:e.jsxs(B,{children:[c.size===1&&d.current.hasNode(f)&&e.jsx(C,{size:"sm",variant:"outline",onClick:()=>o(f),isDisabled:d.current.getNodeAttributes(f).type===je.Master&&a,children:n("panel.details.footer.duplicate")}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>g(c),children:n("panel.details.footer.copy")}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>x(c),children:n("panel.details.footer.remove")})]})})]})};export{Ve as default};
